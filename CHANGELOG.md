# Changelog

变更记录遵循 [Keep a Changelog](https://keepachangelog.com/) 的结构，按日期维护；当仓库开始打版本 tag 时，可再切换为语义化版本号（SemVer）。

## [Unreleased]

### Added
- 信息图素材新增图片历史版本能力：后端增加 `MaterialImageVersion` 与版本切换 API，前端提供统一的“历史版本”弹窗。
- 前端新增无模板批量生成“准备中”反馈（统一风格/提示词准备）并防重复提交。
- 小红书批量出图改为逐张异步生成，卡片内显示生成中动画与计时。
- 小红书单张编辑补齐区域选图与上下文图选择，支持缩略图删除与连续框选。
- 新增后端 `services/tasks/` 任务拆分模块与兼容导出入口。
- 新增 `docs/structure.md` 结构速览文档。
- 主页创建新增“自动识别”模式：可根据输入内容自动判断主题/大纲/逐页脚本，并保留手动切换兜底。

### Changed
- PPT/小红书/信息图预览页的“历史版本”入口统一为共享弹窗组件（替代各自的下拉/自定义弹窗实现）。
- 编辑页图片修改 prompt 文案改为通用“图片”表述（避免不同产品形态误导）。
- 移除页面右下角 GitHub 浮动跳转入口。
- 优化“生成大纲/生成描述”提示词：强调联网核验（若环境支持）、不确定则保守表述并自我检验。
- 无模板模式下：即使项目已填写“额外要求/风格描述”，仍会进行智能整理与融合（不覆盖用户手写风格）。
- README 补充 GRSAI（nano-banana）专用接口的配置与差异说明。
- 小红书出图结果改为写入页面图片与历史版本，预览优先使用 Page 图片并兼容旧素材回退。
- 前端页面与共享选择器组件改为目录化模块组织（`components/` + `hooks/` + `index.tsx`）。
- 后端 `task_manager.py` 重构为兼容层，任务实现拆分到领域模块。
- 主页创建入口合并为单一输入框，输入提示与说明会随产物类型（PPT/信息图/小红书图文）自动适配。
- 小红书出图默认比例调整为 `3:4`，并将可选比例收敛为 `3:4/4:5`（`auto` 与非法值自动回退）。

### Fixed
- 信息图编辑后自动保留 `infographic` 元数据并正确记录/切换“当前版本”，避免系列模式下重复显示或选错最新图。
- 修复无模板批量生成在任务创建前缺少反馈导致的“像没触发”的体验问题。
- 修复小红书描述中 markdown 图片未作为参考图生效的问题。
- 修复详情页批量生成描述缺少进行中状态提示的问题。
- 修复开发模式因旧路径引用导致的 404/白屏问题。
- 修复前端素材生成 API 缺失导出导致的运行时报错。
- 修复生成/编辑接口的 `aspect_ratio=auto` 兼容性：按项目设置/请求参数自动回退到默认值，并校验非法比例。
- 修复信息图/小红书项目在项目详情返回中缺少 materials 导致的历史缩略图/状态展示不完整问题。
- 优化 GenAI 文本输出为 JSON MIME（若支持），降低 JSON 提取/解析失败概率。

## [2026-01-22]

### Added
- 支持在“编辑页面描述”中，单页重新生成时填写**单页额外提示词**（仅该页生效）。

### Changed
- 文生图提示词约束增强：默认禁止页眉/页脚/页码/面包屑/导航条/水印等页面装饰（除非 `page_description` 明确要求）。
- `reference_information` 仅用于上下文理解，禁止渲染其中文字（避免“当前位于章节：...”等被画进页脚/面包屑）。
- 风格描述生成阶段增加约束：默认不生成页眉/页脚/页码/面包屑等要求（除非用户明确要求）。

### Fixed
- 减少生成/导出 PPT 时偶发出现“随机页码/随机页眉页脚/章节面包屑”等烙在图片里的问题（通过提示词硬约束降低发生概率）。

[Unreleased]: https://github.com/flyyangX/vibe-banana-pro/compare/d130dd0...HEAD
[2026-01-22]: https://github.com/flyyangX/vibe-banana-pro/compare/347babf...d130dd0

